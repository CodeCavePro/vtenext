(function(){"use strict";var a=this,b=a.Chart,c=b.helpers,d={scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};b.HorizontalRectangle=b.Element.extend({draw:function(){var a=this.ctx,b=this.height/2,c=this.y-b,d=this.y+b,e=this.left-(this.left-this.x),f=this.strokeWidth/2;this.showStroke&&(c+=f,d-=f,e+=f),a.beginPath(),a.fillStyle=this.fillColor,a.strokeStyle=this.strokeColor,a.lineWidth=this.strokeWidth,a.moveTo(this.left,c),a.lineTo(e,c),a.lineTo(e,d),a.lineTo(this.left,d),a.fill(),this.showStroke&&a.stroke()},inRange:function(a,b){return a>=this.left&&a<=this.x&&b>=this.y-this.height/2&&b<=this.y+this.height/2}}),b.Type.extend({name:"HorizontalBar",defaults:d,initialize:function(a){var d=this.options;this.ScaleClass=b.Scale.extend({offsetGridLines:!0,calculateBarX:function(a,b,c){var e=this.calculateBaseWidth(),f=this.calculateX(c)-e/2,g=this.calculateBarWidth(a);return f+g*b+b*d.barDatasetSpacing+g/2},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*d.barValueSpacing},calculateBarWidth:function(a){var b=this.calculateBaseWidth()-(a-1)*d.barDatasetSpacing;return b/a},calculateBaseHeight:function(){return(this.endPoint-this.startPoint)/this.yLabels.length-2*d.barValueSpacing},calculateBarHeight:function(a){var b=this.calculateBaseHeight()-a*d.barDatasetSpacing;return b/a},calculateXInvertXY:function(a){var b=(this.width-Math.round(this.xScalePaddingLeft)-this.xScalePaddingRight)/(this.max-this.min);return Math.round(this.xScalePaddingLeft)+b*(a-this.min)},calculateYInvertXY:function(a){return a*((this.startPoint-this.endPoint)/this.yLabels.length)},calculateBarY:function(a,b,c){var e=this.calculateBaseHeight(),f=this.endPoint+this.calculateYInvertXY(c)-e/2-5,g=this.calculateBarHeight(a);return a>1&&(f=f+g*(b-1)-b*d.barDatasetSpacing+g/2),f},buildCalculatedLabels:function(){this.calculatedLabels=[];for(var a=c.getDecimalPlaces(this.stepValue),b=0;b<=this.steps;b++)this.calculatedLabels.push(c.template(this.templateString,{value:(this.min+b*this.stepValue).toFixed(a)}))},buildYLabels:function(){this.buildYLabelCounter="undefined"==typeof this.buildYLabelCounter?0:this.buildYLabelCounter+1,this.buildCalculatedLabels(),0===this.buildYLabelCounter&&(this.yLabels=this.xLabels),this.xLabels=this.calculatedLabels,this.yLabelWidth=this.display&&this.showLabels?c.longestText(this.ctx,this.font,this.yLabels)+10:0},calculateX:function(a){var c=(this.xLabelRotation>0,this.width-(this.xScalePaddingLeft+this.xScalePaddingRight)),d=c/(this.steps-(this.offsetGridLines?0:1)),e=d*a+this.xScalePaddingLeft;return this.offsetGridLines&&(e+=d/2),Math.round(e)},draw:function(){var a=this.ctx,b=(this.endPoint-this.startPoint)/this.yLabels.length,d=Math.round(this.xScalePaddingLeft);this.display&&(a.fillStyle=this.textColor,a.font=this.font,c.each(this.yLabels,function(e,f){var g=this.endPoint-b*f,h=Math.round(g),i=this.showHorizontalLines;g-=b/2,a.textAlign="right",a.textBaseline="middle",this.showLabels&&a.fillText(e,d-10,g),0!==f||i||(i=!0),i&&a.beginPath(),f>0?(a.lineWidth=this.gridLineWidth,a.strokeStyle=this.gridLineColor):(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor),h+=c.aliasPixel(a.lineWidth),i&&(a.moveTo(d,h),a.lineTo(this.width,h),a.stroke(),a.closePath()),a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.beginPath(),a.moveTo(d-5,h),a.lineTo(d,h),a.stroke(),a.closePath()},this),c.each(this.xLabels,function(b,d){var e=this.calculateX(1)-this.calculateX(0),f=this.calculateX(d)+c.aliasPixel(this.lineWidth)-e/2,g=this.calculateX(d-(this.offsetGridLines?.5:0))+c.aliasPixel(this.lineWidth),h=this.xLabelRotation>0;a.beginPath(),d>0?(a.lineWidth=this.gridLineWidth,a.strokeStyle=this.gridLineColor):(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor),a.moveTo(g,this.endPoint),a.lineTo(g,this.startPoint-3),a.stroke(),a.closePath(),a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.beginPath(),a.moveTo(g,this.endPoint),a.lineTo(g,this.endPoint+5),a.stroke(),a.closePath(),a.save(),a.translate(f,h?this.endPoint+12:this.endPoint+8),a.rotate(c.radians(this.xLabelRotation)*-1),a.font=this.font,a.textAlign=h?"right":"center",a.textBaseline=h?"middle":"top",a.fillText(b,0,0),a.restore()},this))}}),this.datasets=[],this.options.showTooltips&&c.bindEvents(this,this.options.tooltipEvents,function(a){var b="mouseout"!==a.type?this.getBarsAtEvent(a):[];this.eachBars(function(a){a.restore(["fillColor","strokeColor"])}),c.each(b,function(a){a.fillColor=a.highlightFill,a.strokeColor=a.highlightStroke}),this.showTooltip(b)}),this.BarClass=b.HorizontalRectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx}),c.each(a.datasets,function(b,d){var e={label:b.label||null,fillColor:b.fillColor,strokeColor:b.strokeColor,bars:[]};this.datasets.push(e),c.each(b.data,function(c,d){e.bars.push(new this.BarClass({value:c,label:a.labels[d],datasetLabel:b.label,strokeColor:b.strokeColor,fillColor:b.fillColor,highlightFill:b.highlightFill||b.fillColor,highlightStroke:b.highlightStroke||b.strokeColor}))},this)},this),this.buildScale(a.labels),this.BarClass.prototype.left=Math.round(this.scale.xScalePaddingLeft),this.eachBars(function(a,b,d){c.extend(a,{x:Math.round(this.scale.xScalePaddingLeft),y:this.scale.calculateBarY(this.datasets.length,d,b),height:this.scale.calculateBarHeight(this.datasets.length)}),a.save()},this),this.render()},update:function(){this.scale.update(),c.each(this.activeElements,function(a){a.restore(["fillColor","strokeColor"])}),this.eachBars(function(a){a.save()}),this.render()},eachBars:function(a){c.each(this.datasets,function(b,d){c.each(b.bars,a,this,d)},this)},getBarsAtEvent:function(a){for(var f,b=[],d=c.getRelativePosition(a),e=function(a){b.push(a.bars[f])},g=0;g<this.datasets.length;g++)for(f=0;f<this.datasets[g].bars.length;f++)if(this.datasets[g].bars[f].inRange(d.x,d.y))return c.each(this.datasets,e),b;return b},buildScale:function(a){var b=this,d=function(){var a=[];return b.eachBars(function(b){a.push(b.value)}),a},e={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:a.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(a){var b=c.calculateScaleRange(d(),a,this.fontSize,this.beginAtZero,this.integersOnly);c.extend(this,b)},xLabels:a,font:c.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&c.extend(e,{calculateYRange:c.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new this.ScaleClass(e)},addData:function(a,b){c.each(a,function(a,c){this.datasets[c].bars.push(new this.BarClass({value:a,label:b,x:this.scale.calculateBarX(this.datasets.length,c,this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length),base:this.scale.endPoint,strokeColor:this.datasets[c].strokeColor,fillColor:this.datasets[c].fillColor}))},this),this.scale.addXLabel(b),this.update()},removeData:function(){this.scale.removeXLabel(),c.each(this.datasets,function(a){a.bars.shift()},this),this.update()},reflow:function(){c.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var a=c.extend({height:this.chart.height,width:this.chart.width});this.scale.update(a)},draw:function(a){var b=a||1;this.clear();this.chart.ctx;this.scale.draw(b),c.each(this.datasets,function(a,d){c.each(a.bars,function(a,c){a.hasValue()&&(a.left=Math.round(this.scale.xScalePaddingLeft),a.transition({x:this.scale.calculateXInvertXY(a.value),y:this.scale.calculateBarY(this.datasets.length,d,c),height:this.scale.calculateBarHeight(this.datasets.length)},b).draw())},this)},this)}})}).call(this);